# node os 操作系统

os 模块提供了一些与操作系统相关的实用工具函数，可以获取系统信息、用户信息等。​

## 常用方法

- os.arch()：返回操作系统的架构（如 x64）​
- os.platform()：返回操作系统的平台（如 win32、linux、darwin）​
- os.cpus()：返回系统的 CPU 信息 ​
- os.freemem()：返回可用的系统内存 ​
- os.totalmem()：返回系统的总内存 ​
- os.homedir()：返回当前用户的主目录 ​
- os.uptime()：返回系统运行时间（秒）

## 为什么（总物理内存-当前未用的内存）/ 总物理内存 !== 监控平台的内存占用

| 来源                    | 数据                       | 代表含义                          |
| ----------------------- | -------------------------- | --------------------------------- |
| `os.totalmem()`         | 总物理内存（例如 25.6 GB） | 操作系统总内存                    |
| `os.freemem()`          | 当前未用的内存（很少）     | 排除缓存、buffer 的真正“闲置”内存 |
| 监控平台                | 使用了 74%                 | 可能包括缓存和系统保留空间        |
| `process.memoryUsage()` | 当前 Node 进程自己用的内存 | 你程序是否内存泄漏、占用过高      |

看到的 freemem 很小，但是监控平台显示占用内存 74%，这是合理的现象。因为：

- 操作系统为了性能，把空闲内存用于缓存；
- Node 只报告裸的空闲物理内存，不包含缓存；
- 如果你关心的是你程序自己用多少内存，用 process.memoryUsage()。

## 生成 os 内存报告

核心：解决部分空闲内存被当做缓存使用的问题，因为缓存内存是可回收的，所以不能算在内存使用上。

解决：通过执行 ps 命令获取所有进程的 RSS 总和
