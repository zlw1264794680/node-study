# node 进程、子进程

## process 进程模块

process 模块提供了与当前 Node.js 进程相关的功能，包括获取环境变量、退出进程、与操作系统交互等。

### 常用属性和方法

- process.argv：获取命令行参数 ​
- process.env：访问环境变量 ​
- process.exit()：退出当前进程 ​
- process.cwd()：获取当前工作目录 ​
- process.memoryUsage()：获取进程的内存使用情况 ​
- process.nextTick()：将回调放入下一次事件循环中执行

## child_process 子进程

child_process 模块允许你创建子进程并在其中执行命令、运行外部程序或脚本。这对于处理复杂任务、外部工具集成、并发执行任务非常有用。

### 常用方法

- exec()：用来执行简单命令的，比如 shell 命令或其他外部脚本。它适合用于执行短时间内返回结果的命令。
- spawn()：用于创建一个新进程，并且可以通过数据流与这个进程进行通信。spawn() 适合长时间运行的任务或者需要不断与子进程交互的任务。
- fork()： 是 child_process 中的一个特殊方法，它专门用于创建新的 Node.js 进程，并且允许父子进程之间进行 IPC（进程间通信）。fork() 启动的子进程是一个独立的 Node.js 进程，且可以通过 message 事件进行消息传递。

## worker_threads 线程

Node.js 中的 worker_threads —— 这是在 Node v10.5.0+ 引入的一个模块，用于在 单个进程中创建多个线程，让 Node.js 能真正进行 多线程并发计算（尤其适合 CPU 密集型任务）。

Node.js 默认是 单线程、事件驱动 的；
但通过 worker_threads 模块，你可以开启多个线程：每个线程运行独立的 JS 文件；线程之间可以共享内存（使用 SharedArrayBuffer）；
通信通过 postMessage 和事件触发（类似于 Web Worker）。

## 总结

- 进程：操作系统级别的隔离单元，具有独立的内存空间和资源，适合运行大型任务或服务。
- 子进程（child_process）：由主进程派生出的独立进程，适合运行外部命令或隔离任务，无法直接共享内存。
- 线程（worker_threads）：在同一个进程中运行的轻量级执行单元，可以使用 SharedArrayBuffer 共享部分内存，适合高性能并发计算或 CPU 密集型任务。

⚠️ 注意：对于文件读写、网络请求、数据库等 I/O 密集型任务，直接使用 Node.js 内置的 异步 API（如 async/await、Promise）就足够高效。启动线程反而会引入开销，得不偿失。

## 使用子进程的场景 ​

- 并行执行任务：当有多个任务需要并行处理时，可以使用 spawn() 或 fork() 来创建多个子进程，从而提高应用的并发能力。​
- 执行外部命令或脚本：使用 exec() 来执行外部的 shell 命令、调用外部工具等。​
- 分离任务：如果一个任务可能导致崩溃或阻塞主进程，可以将其放入子进程中运行，以确保主进程的健壮性。​

子进程在 Node.js 中提供了一种非常强大的方式来处理 CPU 密集型任务或与外部系统集成，从而增强了单线程的 Node.js 应用的并行处理能力。​
